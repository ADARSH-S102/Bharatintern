import { Injectable } from '@angular/core';
import { HttpClient } from '@angular/common/http';
import { BehaviorSubject } from 'rxjs';

@Injectable({
  providedIn: 'root'
})
export class TravelService {

  private travels: any[] = [];
  private travelSubject = new BehaviorSubject<any[]>([]);
  travels$ = this.travelSubject.asObservable();

  constructor(private http: HttpClient) {
    const saved = localStorage.getItem('travels');
    if (saved) {
      this.travels = JSON.parse(saved);
      this.travelSubject.next(this.travels);
    }
  }

  // ‚≠ê REPLACE OLD addTravel() WITH THIS ONE
  addTravel(data: any) {
    return this.http.post("http://localhost:8081/travel/start", data);
  }

  // ‚≠ê You keep this ‚Äî used by your UI
  updateStatus(uid: string, status: string): void {
    const record = this.travels.find(t => t.uid === uid);
    if (record) {
      record.status = status;
      this.travelSubject.next(this.travels);
      localStorage.setItem('travels', JSON.stringify(this.travels));
    }
  }

  getTravels(): any[] {
    return this.travels;
  }

  clearAll(): void {
    this.travels = [];
    this.travelSubject.next(this.travels);
    localStorage.removeItem('travels');
  }
}













import { Component, OnInit } from '@angular/core';
import { FormBuilder, FormGroup, Validators, ReactiveFormsModule } from '@angular/forms';
import { CommonModule } from '@angular/common';
import Swal from 'sweetalert2';
import { DropdownService } from '../dropdown/dropdown.service';
import { TravelService } from '../services/travel.service';
import { endAfterStartValidator } from '../date-range.validator';

@Component({
  selector: 'app-travel',
  standalone: true,
  templateUrl: './travel.html',
  styleUrls: ['./travel.css'],
  imports: [CommonModule, ReactiveFormsModule]
})
export class TravelComponent implements OnInit {

  travelForm!: FormGroup;

  domains: string[] = [];
  clusters: string[] = [];
  subclusters: string[] = [];
  cluster1List: string[] = [];
  hods: string[] = [];
  originCities: string[] = [];
  destinationCities: string[] = [];
  travelTypes: string[] = [];
  travelClasses: string[] = [];
  types: string[] = [];
  businessManager: string[] = [];

  constructor(
    private fb: FormBuilder,
    private dropdownService: DropdownService,
    private travelService: TravelService
  ) {}

  ngOnInit(): void {
    this.travelForm = this.fb.group({
      uid: ['', Validators.required],
      name: ['', Validators.required],
      lineManager: ['', Validators.required],
      domain: ['', Validators.required],
      cluster: ['', Validators.required],
      subcluster: ['', Validators.required],
      cluster1: ['', Validators.required],
      hod: ['', Validators.required],
      originCity: ['', Validators.required],
      destinationCity: ['', Validators.required],
      startDate: ['', Validators.required],
      endDate: ['', Validators.required],
      travelType: ['', Validators.required],
      travelClass: ['', Validators.required],
      type: ['', Validators.required],
      purposeOfTravel: ['', Validators.required],
      businessManager: ['', Validators.required]
    }, {
      validators: endAfterStartValidator('startDate', 'endDate')
    });

    this.loadDropdowns();
  }

  loadDropdowns(): void {

    const mappings: { [key: string]: (data: string[]) => void } = {
      domain: data => this.domains = data,
      cluster: data => this.clusters = data,
      subcluster: data => this.subclusters = data,
      cluster1: data => this.cluster1List = data,
      hod: data => this.hods = data,
      originCity: data => this.originCities = data,
      destinationCity: data => this.destinationCities = data,
      travelType: data => this.travelTypes = data,
      travelClass: data => this.travelClasses = data,
      type: data => this.types = data,
      businessManager: data => this.businessManager = data
    };

    Object.keys(mappings).forEach(key => {
      this.dropdownService.getOptions(key).subscribe({
        next: (data) => mappings[key](Array.isArray(data) ? data : []),
        error: (err) => console.error(`Failed to fetch ${key} options`, err)
      });
    });
  }

  onSubmit(): void {

    if (this.travelForm.invalid) {
      Swal.fire("Error", "Please complete all required fields", "error");
      return;
    }

    const travelData = this.travelForm.value;

    // ‚¨áÔ∏è‚¨áÔ∏è‚¨áÔ∏è THIS IS THE ONLY LINE YOU MUST UPDATE ‚¨áÔ∏è‚¨áÔ∏è‚¨áÔ∏è
    this.travelService.startTravelProcess(travelData).subscribe({
      next: (res) => {
        Swal.fire("Success", "Travel request submitted!", "success");
        this.travelForm.reset();
      },
      error: (err) => {
        console.error(err);
        Swal.fire("Error", "Failed to submit form", "error");
      }
    });
    // ‚¨ÜÔ∏è‚¨ÜÔ∏è‚¨ÜÔ∏è ONLY THIS NEW LINE CHANGES ‚¨ÜÔ∏è‚¨ÜÔ∏è‚¨ÜÔ∏è
  }
}









Perfect ‚Äî I‚Äôll give you clean, production-ready Spring Boot files with exact filenames so you can copy‚Äìpaste them directly into:

src/main/java/com/yourcompany/yourapp/controller/
src/main/java/com/yourcompany/yourapp/service/
src/main/java/com/yourcompany/yourapp/dto/

Everything is structured and ready to drop into your existing backend.

‚∏ª

‚úÖ 1. FILE 1 ‚Äî TravelRequest.java

Location:

src/main/java/com/yourcompany/yourapp/dto/TravelRequest.java

package com.yourcompany.yourapp.dto;

public class TravelRequest {

    private String uid;
    private String name;
    private String lineManager;
    private String domain;
    private String cluster;
    private String subcluster;
    private String cluster1;
    private String hod;
    private String originCity;
    private String destinationCity;
    private String startDate;
    private String endDate;
    private String businessManager;
    private String travelClass;
    private String travelType;
    private String type;
    private String purposeOfTravel;

    // --- GETTERS & SETTERS ---
    public String getUid() { return uid; }
    public void setUid(String uid) { this.uid = uid; }

    public String getName() { return name; }
    public void setName(String name) { this.name = name; }

    public String getLineManager() { return lineManager; }
    public void setLineManager(String lineManager) { this.lineManager = lineManager; }

    public String getDomain() { return domain; }
    public void setDomain(String domain) { this.domain = domain; }

    public String getCluster() { return cluster; }
    public void setCluster(String cluster) { this.cluster = cluster; }

    public String getSubcluster() { return subcluster; }
    public void setSubcluster(String subcluster) { this.subcluster = subcluster; }

    public String getCluster1() { return cluster1; }
    public void setCluster1(String cluster1) { this.cluster1 = cluster1; }

    public String getHod() { return hod; }
    public void setHod(String hod) { this.hod = hod; }

    public String getOriginCity() { return originCity; }
    public void setOriginCity(String originCity) { this.originCity = originCity; }

    public String getDestinationCity() { return destinationCity; }
    public void setDestinationCity(String destinationCity) { this.destinationCity = destinationCity; }

    public String getStartDate() { return startDate; }
    public void setStartDate(String startDate) { this.startDate = startDate; }

    public String getEndDate() { return endDate; }
    public void setEndDate(String endDate) { this.endDate = endDate; }

    public String getBusinessManager() { return businessManager; }
    public void setBusinessManager(String businessManager) { this.businessManager = businessManager; }

    public String getTravelClass() { return travelClass; }
    public void setTravelClass(String travelClass) { this.travelClass = travelClass; }

    public String getTravelType() { return travelType; }
    public void setTravelType(String travelType) { this.travelType = travelType; }

    public String getType() { return type; }
    public void setType(String type) { this.type = type; }

    public String getPurposeOfTravel() { return purposeOfTravel; }
    public void setPurposeOfTravel(String purposeOfTravel) { this.purposeOfTravel = purposeOfTravel; }
}


‚∏ª

‚úÖ 2. FILE 2 ‚Äî TravelController.java

Location:

src/main/java/com/yourcompany/yourapp/controller/TravelController.java

package com.yourcompany.yourapp.controller;

import com.yourcompany.yourapp.dto.TravelRequest;
import com.yourcompany.yourapp.service.TravelCamundaService;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.web.bind.annotation.*;

@RestController
@RequestMapping("/travel")
public class TravelController {

    @Autowired
    private TravelCamundaService travelService;

    @PostMapping("/start")
    public String startTravelProcess(@RequestBody TravelRequest request) {
        return travelService.startProcess(request);
    }

    @PostMapping("/complete/{taskId}")
    public String completeTask(@PathVariable String taskId, @RequestBody TravelRequest request) {
        return travelService.completeTask(taskId, request);
    }
}


‚∏ª

‚úÖ 3. FILE 3 ‚Äî TravelCamundaService.java

Location:

src/main/java/com/yourcompany/yourapp/service/TravelCamundaService.java

package com.yourcompany.yourapp.service;

import com.yourcompany.yourapp.dto.TravelRequest;
import org.springframework.stereotype.Service;
import org.springframework.web.client.RestTemplate;

import java.util.HashMap;
import java.util.Map;

@Service
public class TravelCamundaService {

    private final RestTemplate restTemplate = new RestTemplate();
    private final String CAMUNDA_URL = "http://localhost:8080/engine-rest";

    // --- START PROCESS ---
    public String startProcess(TravelRequest req) {

        Map<String, Object> variables = buildVariables(req);

        Map<String, Object> body = new HashMap<>();
        body.put("variables", variables);

        String url = CAMUNDA_URL + "/process-definition/key/TRAVEL_PROCESS/start";

        return restTemplate.postForObject(url, body, String.class);
    }

    // --- COMPLETE USER TASK ---
    public String completeTask(String taskId, TravelRequest req) {

        Map<String, Object> variables = buildVariables(req);

        Map<String, Object> body = new HashMap<>();
        body.put("variables", variables);

        String url = CAMUNDA_URL + "/task/" + taskId + "/complete";

        return restTemplate.postForObject(url, body, String.class);
    }

    // --- Convert DTO ‚Üí Camunda Variables ---
    private Map<String, Object> buildVariables(TravelRequest req) {

        Map<String, Object> vars = new HashMap<>();

        vars.put("uid", camVar(req.getUid()));
        vars.put("name", camVar(req.getName()));
        vars.put("lineManager", camVar(req.getLineManager()));
        vars.put("domain", camVar(req.getDomain()));
        vars.put("cluster", camVar(req.getCluster()));
        vars.put("subcluster", camVar(req.getSubcluster()));
        vars.put("cluster1", camVar(req.getCluster1()));
        vars.put("hod", camVar(req.getHod()));
        vars.put("originCity", camVar(req.getOriginCity()));
        vars.put("destinationCity", camVar(req.getDestinationCity()));
        vars.put("startDate", camVar(req.getStartDate()));
        vars.put("endDate", camVar(req.getEndDate()));
        vars.put("businessManager", camVar(req.getBusinessManager()));
        vars.put("travelClass", camVar(req.getTravelClass()));
        vars.put("travelType", camVar(req.getTravelType()));
        vars.put("type", camVar(req.getType()));
        vars.put("purposeOfTravel", camVar(req.getPurposeOfTravel()));

        return vars;
    }

    // Helper to wrap each variable in Camunda format
    private Map<String, Object> camVar(Object value) {
        return Map.of(
            "value", value,
            "type", "String"
        );
    }
}


‚∏ª

üéâ DONE ‚Äî You now have full working backend integration

Everything goes through backend ‚Üí Camunda.
Angular remains untouched.

‚∏ª

üìå If needed, I can also generate:

‚úÖ User task fetch API

‚úÖ Approval flow (LM ‚Üí BM ‚Üí HOD ‚Üí HR)

‚úÖ BPMN flow using all these variables

‚úÖ Camunda Form JSON (if you want dynamic forms)

Just tell me what you want next.
